# "boiler-plate" required by TOSCA
tosca_definitions_version: tosca_simple_yaml_1_2


# High-level metadata (to be filled from metadata)
metadata:
  id: microservice_12312124
  name: RISTRA@EDGE
  author: Johannes Mueller-Roehmer 
  date: 2021-07-05
  version: 1
  description: RISTRA is an efficient structural mechanics solver   
  classificationSchema: Simulation 
  shortDescription: [ Solver for Structural Analysis, Linear Elasticity ] 
  software: [ RISTRA ]
  software version: [ RISTRA20/21] 


# "boiler-plate" required by MiCADO (auto-generated for each MDT)
imports:
  - https://raw.githubusercontent.com/micado-scale/tosca/master/micado_types.yaml

node_types:
  dbs.microservice_12312124:
    derived_from: dbs.microservice

topology_template:
  substitution_mappings:
    node_type: dbs.microservice_12312124

  # Generated because the metadata for RISTRA includes "parameter variables"
  inputs:
    MODEL_FILENAME:
      type: string
      required: true
    ORIGIN:
      type: string
      required: true

  node_templates:
    # Container configuration (to be generated by k8s2adt)      
    ristra-edge:
      type: tosca.nodes.MiCADO.Container.Application.Docker.Deployment
      properties:
        command: ["sudo", "./start.sh"]
        args: { get_input: MODEL_FILENAME }
        image: dbs-container-repo.emgora.eu:443/ristra:v0.711
      requirements:
      - volume:
          name: ristra-edge-volume-1
          relationship:
            type: tosca.relationships.AttachesTo
            properties:
              location: /model/inputs
      - host:
      # Hardware/software requirements (to be filled from metadata)
          node_filter:
            capabilities:
            - host:
                properties:
                - num_cpus: { greater_or_equal: 2 }
                - mem_size: { greater_or_equal: "4 GB" }
                - num_gpus: { greater_or_equal: 1 }              
                - mem_gpus: { greater_or_equal: "2 GB" }
                - disk_size: { greater_or_equal: "2 GB" }
            - os:
                properties:
                - os_arch: { equal: x86_64 } 
                - os_type: { equal: Linux } 
                - os_distribution: { equal: Ubuntu }
                - os_version: { equal: 20.04 }
    
    # Volume configuration (to be generated by k8s2adt) 
    ristra-edge-volume-1:
      type: tosca.nodes.MiCADO.Container.Volume.HostPath
      properties:
        path: { get_input: ORIGIN }