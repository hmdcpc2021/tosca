tosca_definitions_version: tosca_simple_yaml_1_2

metadata:
  author: Jay DesLauriers

imports:
  - https://raw.githubusercontent.com/micado-scale/tosca/develop/micado_types.yaml

repositories:
  docker_hub: https://hub.docker.com/

description: Example ADT for SSE Server & TA (ASCLEPIOS)

topology_template:
  node_templates:
    sse:
      type: tosca.nodes.MiCADO.Container.Application.Docker.Deployment
      properties:
        image: uowcpc/asclepios-server:0.2_postgres
        ports:
        - target: 8080
        env:
        - name: DJANGO_LOGLEVEL
          value: DEBUG
        - name: TA_SERVER
          value: "http://ta:8000"
        - name: DB_NAME
          value: sse-db
        - name: DB_USER
          value: sse
        - name: DB_PASSWORD
          value: ADD_YOUR_SSE_DB_PASSWORD_HERE
        - name: DB_HOST
          value: sse-db
        - name: DB_PORT
          value: "5432"
        - name: ALLOWED_HOSTS
          value: "*"
        - name: MINIO_ACCESS_KEY
          value: "minio"
        - name: MINIO_SECRET_KEY
          value: "minio123"
        - name: MINIO_BUCKET_NAME
          value: "snet"
        - name: MINIO_URL
          value: "minio:9000"
        - name: MINIO_SSL_SECURE
          value: "false"
        - name: MINIO_EXPIRE_GET
          value: "true"
        - name: MINIO_EXPIRE_PUT
          value: "true"
      requirements:
      - host: sse-node

    sse-db:
      type: tosca.nodes.MiCADO.Container.Application.Docker.Deployment
      properties:
        image: postgres
        ports:
        - target: 5432
        env:
        - name: POSTGRES_USER 
          value: sse
        - name: POSTGRES_PASSWORD 
          value: ADD_YOUR_SSE_DB_PASSWORD_HERE
        - name: POSTGRES_DB
          value: sse-db
        - name: PGDATA
          value: /var/lib/postgresql/data
      requirements:
      - host: sse-node

    ta:
      type: tosca.nodes.MiCADO.Container.Application.Docker.Deployment
      properties:
        image: uowcpc/asclepios-ta:0.2_postgres
        ports:
        - target: 8000
        env:
        - name: DJANGO_LOGLEVEL
          value: DEBUG
        - name: DB_NAME
          value: ta-db
        - name: DB_USER
          value: ta
        - name: DB_PASSWORD
          value: ADD_YOUR_TA_DB_PASSWORD_HERE
        - name: DB_HOST
          value: ta-db 
        - name: DB_PORT
          value: "5432"
        - name: ALLOWED_HOSTS
          value: "*"
        - name: HASH_LENGTH
          value: "256"
        - name: KEY_G
          value: "123"
        - name: SALT
          value: abc123!?
        - name: IV
          value: abcdefg
      requirements:
      - host: ta-node

    ta-db:
      type: tosca.nodes.MiCADO.Container.Application.Docker.Deployment
      properties:
        image: postgres
        ports:
        - target: 5432
        env:
        - name: POSTGRES_USER 
          value: ta
        - name: POSTGRES_PASSWORD 
          value: ADD_YOUR_TA_DB_PASSWORD_HERE
        - name: POSTGRES_DB
          value: ta-db
        - name: PGDATA
          value: /var/lib/postgresql/data
      requirements:
      - host: ta-node

    sse-node:
      type: tosca.nodes.MiCADO.EC2.Compute
      properties:
        region_name:
        image_id:
        instance_type:
        key_name:
        security_group_ids:
          -
      interfaces:
        Occopus:
          create:
            inputs:
              endpoint:

    ta-node:
      type: tosca.nodes.MiCADO.EC2.Compute
      properties:
        region_name:
        image_id:
        instance_type:
        key_name:
        security_group_ids:
          -
      interfaces:
        Occopus:
          create:
            inputs:
              endpoint:

  policies:
    - monitoring:
        type: tosca.policies.Monitoring.MiCADO
        properties:
          enable_container_metrics: true
          enable_node_metrics: true